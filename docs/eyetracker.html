<!DOCTYPE html>
<html>
<head>
  <title>Eye Tracking Test</title>
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      width: 100%;
      overflow: hidden;
    }
    #heatmap {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: block;
      border: 1px solid black;
      z-index: 1;
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      color: #000;
      padding: 1em 2em;
      text-align: center;
      background: rgba(255,255,255,0.8);
      border-bottom-left-radius: 1em;
      border-bottom-right-radius: 1em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
  </style>
</head>
<body>

  <div id="overlay">
    <h1>Eye Tracker Test</h1>
    <p>Look around the screen and WebGazer will estimate your gaze.</p>
  </div>
  <canvas id="heatmap"></canvas>

  <script>
    // Resize canvas to fill window
    const canvas = document.getElementById('heatmap');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Start WebGazer
    webgazer.setRegression('ridge')        // use ridge regression
            .setTracker('clmtrackr')       // use clmtrackr for face tracking
            .begin();

    // Optional: show video feedback while calibrating
    webgazer.showVideoPreview(true) 
            .showPredictionPoints(true); 

    // Log gaze data & draw to canvas (only gaze, not mouse)
    webgazer.setGazeListener(function(data, elapsedTime) {
      if (data == null) return;
      let x = data.x; // gaze x
      let y = data.y; // gaze y

      // Draw a red dot for gaze point
      ctx.fillStyle = "rgba(255,0,0,0.5)";
      ctx.beginPath();
      ctx.arc(x, y, 5, 0, 2 * Math.PI);
      ctx.fill();

      // Optionally send data to server
      /*
      fetch("/log_gaze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ x, y, elapsedTime })
      });
      */
    });

    // Remove any mouse event listeners that would draw dots (none present in this code)
  </script>
</body>
</html>